language: cpp

sudo: required
dist: trusty

before_install:
    - sudo apt-get -qq update 2>&1 | tee /tmp/apt.log
    - fgrep Failed /tmp/apt.log && sleep 60 && rm /tmp/apt.log && sudo apt-get -qq update 2>&1 | tee /tmp/apt.log || true
    - fgrep Failed /tmp/apt.log && sleep 60 && rm /tmp/apt.log && sudo apt-get -qq update 2>&1 | tee /tmp/apt.log || true
    - travis_retry sudo apt-get install -y fbset v86d

script:
- git clone https://github.com/Freescale/linux-module-virtfb.git
- pushd linux-module-virtfb
- sed -i 's/VM_RESERVED/0x00080000/g' virtual_fb.c
- sed -i 's/mach-types/types/g' virtual_fb.c
- make -C "/usr/src/linux-headers-$(uname -r)" M="$(pwd)"
- insmod virtual_fb.ko vfbcount=1
- popd
- sudo dmesg | tail -50
- sudo fbset -i
- sudo fbset -xres 1920 -yres 1080
- sudo lsmod
- sudo ls -la /dev
- sudo cat /proc/cmdline
- echo done!

